<!DOCTYPE html>
<html>
  <head>
    <base target="_top" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      /* your existing styles unchanged */
    </style>
  </head>
  <body>
    <div class="bubbles">
      <span></span><span></span><span></span><span></span><span></span>
      <span></span><span></span><span></span><span></span><span></span>
      <span></span><span></span><span></span><span></span><span></span>
      <span></span><span></span><span></span><span></span><span></span>
    </div>

    <div class="form-container">
      <img src="https://i.imgur.com/3CNZdsB.jpeg" alt="Logo" class="logo" />
      <h2>Buy SMS Credits via Mpesa</h2>
      <p style="color: red; font-weight: bold; text-align: center; margin-top: -12px;">
        After successful purchase of SMS credits, go to your dashboard to view updated SMS credits.
      </p>

      <label for="name">Full Name:</label>
      <input type="text" id="name" required autocomplete="off" />

      <label for="nationalId">National ID or USER ID:</label>
      <input type="text" id="nationalId" required autocomplete="off" />

      <label for="phoneNumber">Phone Number (Contact):</label>
      <input type="tel" id="phoneNumber" required autocomplete="off"
             pattern="0\d{9}" minlength="10" maxlength="10"
             title="Enter a valid 10-digit phone number starting with 0 (e.g., 0712345678)" />

      <label for="amount">Amount (Min 50 KSh):</label>
      <input type="number" id="amount" min="5" required autocomplete="off" />

      <label for="mpesaNumber">Mpesa Number:</label>
      <input type="tel" id="mpesaNumber" required autocomplete="off"
             pattern="0\d{9}" minlength="10" maxlength="10"
             title="Enter a valid 10-digit Mpesa number starting with 0 (e.g., 0712345678)" />

      <button type="button" onclick="payNow()">Pay Now</button>

      <p id="responseMsg"></p>
    </div>

    <script>
      function payNow() {
        const name = document.getElementById('name').value.trim();
        const nationalId = document.getElementById('nationalId').value.trim();
        const phoneNumber = document.getElementById('phoneNumber').value.trim();
        const amount = parseFloat(document.getElementById('amount').value);
        const mpesaNumber = document.getElementById('mpesaNumber').value.trim();
        const msgEl = document.getElementById('responseMsg');

        if (!name) {
          msgEl.innerText = 'Please enter your full name.';
          msgEl.className = 'error';
          return;
        }
        if (!nationalId) {
          msgEl.innerText = 'Please enter your National ID or USER ID.';
          msgEl.className = 'error';
          return;
        }
        if (!phoneNumber.match(/^0\d{9}$/)) {
          msgEl.innerText = 'Please enter a valid phone number starting with 0.';
          msgEl.className = 'error';
          return;
        }
        if (isNaN(amount) || amount < 50) {
          msgEl.innerText = 'Please enter an amount of at least 50 KSh.';
          msgEl.className = 'error';
          return;
        }
        if (!mpesaNumber.match(/^0\d{9}$/)) {
          msgEl.innerText = 'Please enter a valid Mpesa number starting with 0.';
          msgEl.className = 'error';
          return;
        }

        msgEl.innerText = 'Processing...';
        msgEl.className = '';

        fetch('https://tiny-base-3032.ev-dmaundu.workers.dev/', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, nationalId, phoneNumber, amount, mpesaNumber })
        })
          .then((response) => response.json())
          .then((data) => {
            msgEl.innerText = data.message;
            msgEl.className = data.success ? 'success' : 'error';
            if (data.success) {
              document.getElementById('name').value = '';
              document.getElementById('nationalId').value = '';
              document.getElementById('phoneNumber').value = '';
              document.getElementById('amount').value = '';
              document.getElementById('mpesaNumber').value = '';
            }
          })
          .catch(() => {
            msgEl.innerText = 'An error occurred. Please try again.';
            msgEl.className = 'error';
          });
      }
    </script>
  </body>
</html>
